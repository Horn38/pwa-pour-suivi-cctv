<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Rapport Bouchonnage</title>
	<style>
    	body {
        	font-family: Arial, sans-serif;
        	margin: 10px;
        	background: white;
        	color: black;
        	transition: background 0.3s, color 0.3s;
        	position: relative;
    	}

    	body::before {
        	content: '';
        	position: absolute;
        	top: 0; left: 0; right: 0; bottom: 0;
        	background: rgba(255, 255, 255, 0.75);
        	pointer-events: none;
        	z-index: -1;
        	transition: background 0.3s;
    	}

    	.dark-mode {
        	background-color: #121212;
        	color: #e0e0e0;
    	}

    	.dark-mode::before {
        	background: rgba(0, 0, 0, 0.70);
    	}

    	.gabou-mode {
        	background: url('https://media.craiyon.com/2025-10-19/qOiYlt2bQImVLZ5o0HTYSQ.webp') no-repeat center center fixed !important;
        	background-size: cover !important;
    	}

    	.gabou-mode::before {
        	background: rgba(0, 80, 120, 0.55) !important;
    	}

    	.dark-mode input, .dark-mode select, .dark-mode textarea {
        	background: #333;
        	color: #e0e0e0;
        	border-color: #555;
    	}

    	.dark-mode table, .dark-mode th, .dark-mode td {
        	border-color: #555;
    	}

    	h1 { text-align: center; margin-bottom: 20px; }
    	label { font-weight: bold; margin-top: 10px; }
    	input, select, textarea {
        	width: 100%;
        	padding: 8px;
        	margin: 5px 0;
        	box-sizing: border-box;
        	border: 1px solid #ccc;
        	border-radius: 4px;
        	background: rgba(255, 255, 255, 0.9);
    	}
    	textarea {
        	height: 150px;
        	resize: vertical;
    	}
    	table {
        	width: 100%;
        	border-collapse: collapse;
        	margin-top: 20px;
    	}
    	th, td {
        	border: 1px solid #000;
        	padding: 8px;
        	text-align: center;
    	}
    	th {
        	background-color: #28a745 !important;
        	color: white !important;
        	font-weight: bold;
    	}
    	button {
        	padding: 12px 20px;
        	margin: 10px 5px;
        	font-size: 16px;
        	background-color: #007bff;
        	color: white;
        	border: none;
        	border-radius: 5px;
        	cursor: pointer;
    	}
    	button:hover {
        	background-color: #0056b3;
    	}
    	.diametre-btn {
        	padding: 10px 20px;
        	margin: 5px;
        	font-size: 16px;
        	background-color: #0056b3;
        	color: white;
        	border: 2px solid #004085;
        	border-radius: 6px;
        	cursor: pointer;
    	}
    	.diametre-btn:hover {
        	background-color: #004085;
    	}
    	.diametre-btn.active {
        	background-color: #a0c4ff !important;
        	color: #000;
        	font-weight: bold;
        	border: 2px solid #007bff;
    	}
    	#autreInput {
        	display: none;
        	width: 100px;
        	padding: 8px;
        	margin-left: 10px;
        	border: 2px solid #007bff;
        	border-radius: 4px;
        	font-weight: bold;
    	}
    	.form-grid {
        	display: grid;
        	grid-template-columns: 1fr 1fr 1fr;
        	gap: 10px;
        	align-items: end;
    	}
    	.grid-full { grid-column: 1 / -1; }
    	.grid-2col { grid-column: span 2; }
    	.flex-row {
        	display: flex;
        	align-items: center;
        	gap: 10px;
    	}
    	.longueur-row {
        	display: flex;
        	gap: 20px;
        	align-items: center;
    	}
    	.longueur-input {
        	flex: 1;
    	}
    	.blocked-cell {
        	background-color: black !important;
        	color: black !important;
    	}
    	.dark-mode .blocked-cell {
        	background-color: #222 !important;
        	color: #444 !important;
    	}
    	.top-buttons {
        	display: flex;
        	justify-content: center;
        	gap: 20px;
        	margin-bottom: 10px;
    	}
    	.top-btn {
        	padding: 10px 20px;
        	font-size: 18px;
        	background-color: #28a745;
        	color: white;
        	border: none;
        	border-radius: 8px;
        	cursor: pointer;
    	}
    	.top-btn:hover {
        	background-color: #218838;
    	}
    	#deleteBtn {
        	background-color: #e74c3c !important;
    	}
    	#deleteBtn:hover {
        	background-color: #c0392b !important;
    	}
    	#resetBtn {
        	background-color: #dc3545 !important;
    	}
    	#resetBtn:hover {
        	background-color: #c82333 !important;
    	}
    	#saveBtn { background-color: #2196F3 !important; }
    	#saveBtn:hover { background-color: #1976D2 !important; }
    	#driveBtn { background-color: #4285F4 !important; }
    	#driveBtn:hover { background-color: #3367D6 !important; }
    	#loadBtn { background-color: #FF9800 !important; }
    	#loadBtn:hover { background-color: #F57C00 !important; }

    	.highlight-buttons {
        	text-align: center;
        	margin: 20px 0;
    	}
    	.color-btn {
        	width: 50px;
        	height: 50px;
        	margin: 5px;
        	border: 3px solid #000;
        	border-radius: 8px;
        	cursor: pointer;
    	}
    	.dark-mode .color-btn {
        	border-color: #fff;
    	}
    	.color-btn.active {
        	border: 5px solid yellow !important;
        	box-shadow: 0 0 10px yellow;
    	}
    	#noneBtn {
        	background: transparent !important;
        	border: 3px dashed gray !important;
    	}
    	.highlight-mauve { background-color: #9370DB !important; color: white; }
    	.highlight-red { background-color: red !important; color: white; }
    	.highlight-yellow { background-color: yellow !important; color: black; }
    	.highlight-blue { background-color: blue !important; color: white; }
    	.highlight-green { background-color: green !important; color: white; }
    	.notes-section {
        	margin-top: 30px;
    	}
    	.hidden { display: none; }
	</style>
</head>
<body>

	<div class="top-buttons">
    	<button class="top-btn" id="langBtn" onclick="toggleLang()">FR</button>
    	<button class="top-btn" id="themeBtn" onclick="toggleTheme()">‚òÄÔ∏è</button>
	</div>

	<h1 id="title">Bouchonnage et Rapport de Per√ßage</h1>

	<div class="form-grid">
    	<div>
        	<label id="labelProjet">Projet :</label>
        	<input type="text" id="projet" value="">
    	</div>
    	<div>
        	<label id="labelDate">Date :</label>
        	<input type="date" id="date" value="">
    	</div>
    	<div>
        	<label id="labelVille">Ville :</label>
        	<input type="text" id="ville" value="">
    	</div>

    	<div class="grid-2col">
        	<label id="labelRue">Rue :</label>
        	<input type="text" id="rue" value="">
    	</div>
    	<div>
        	<label id="labelPuits">Num√©ro de puits :</label>
        	<div class="flex-row">
            	<input type="text" id="puitsDebut" value="" style="width: 100px;">
            	<span style="font-weight: bold;" id="toText">√†</span>
            	<input type="text" id="puitsFin" value="" style="width: 100px;">
        	</div>
    	</div>

    	<div class="grid-2col">
        	<label id="labelDiametre">Diam√®tre :</label>
        	<div style="display: flex; align-items: center; flex-wrap: wrap;">
            	<button class="diametre-btn" onclick="setDiametre(6)">6</button>
            	<button class="diametre-btn" onclick="setDiametre(8)">8</button>
            	<button class="diametre-btn" onclick="setDiametre(10)">10</button>
            	<button class="diametre-btn" onclick="setDiametre(12)">12</button>
            	<button class="diametre-btn" onclick="setDiametre('autre')">Autre</button>
            	<input type="text" id="autreInput" value="">
            	<span id="diametreDisplay" style="margin-left:20px; font-weight:bold; color:#0056b3;"></span>
        	</div>
    	</div>
    	<div>
        	<label id="labelOperateur">Op√©rateur :</label>
        	<input type="text" id="operateur" value="">
    	</div>

    	<div class="grid-full">
        	<label id="labelLongueur">Longueur (m.) :</label>
        	<div class="longueur-row">
            	<div class="longueur-input">
                	<label style="font-weight: normal; font-size: 0.9em;" id="labelCamera">Cam√©ra</label>
                	<input type="text" id="longueurCamera" value="">
            	</div>
            	<div class="longueur-input">
                	<label style="font-weight: normal; font-size: 0.9em;" id="labelRoulette">Roulette</label>
                	<input type="text" id="longueurRoulette" value="">
            	</div>
        	</div>
    	</div>
	</div>

	<table id="tableau">
    	<thead>
        	<tr>
            	<th id="thDistance">Distance</th>
            	<th id="thType">Type de service</th>
            	<th id="thAdresse">Adresse</th>
            	<th id="thPosition">Position</th>
            	<th id="thBouchon">Bouchon</th>
            	<th id="thEstimation">Estimation</th>
            	<th id="thPercage">Per√ßage</th>
            	<th id="thCommentaires">Commentaires</th>
        	</tr>
    	</thead>
    	<tbody></tbody>
	</table>

	<div class="highlight-buttons">
    	<strong id="highlightText">Surligner la ligne :</strong><br>
    	<button class="color-btn" style="background: red;" onclick="setHighlightColor('red')"></button>
    	<button class="color-btn" style="background: #9370DB;" onclick="setHighlightColor('mauve')"></button>
    	<button class="color-btn" style="background: yellow;" onclick="setHighlightColor('yellow')"></button>
    	<button class="color-btn" style="background: blue;" onclick="setHighlightColor('blue')"></button>
    	<button class="color-btn" style="background: green;" onclick="setHighlightColor('green')"></button>
    	<button class="color-btn" id="noneBtn" onclick="setHighlightColor('none')"></button>
	</div>

	<div style="text-align: center;">
    	<button id="btnAddLine" onclick="ajouterLigne()">Ajouter une ligne</button>
    	<button id="deleteBtn" onclick="effacerDerniereLigne()">Effacer la derni√®re ligne</button>
    	<button id="resetBtn" onclick="reinitialiserTout()">R√©initialiser tout</button>
    	<button id="saveBtn">Sauvegarder le projet</button>
    	<button id="driveBtn">Envoyer sur Drive</button>
    	<button id="loadBtn">Ouvrir un projet</button>
	</div>

	<div class="notes-section">
    	<label id="labelNotes">Notes :</label>
    	<textarea id="notes"></textarea>
	</div>

	<input type="file" id="fileInput" accept=".json" class="hidden">

	<script>
    	let diametreChoisi = '';
    	let isFrench = true;
    	let currentHighlight = '';

    	function checkGabouMode() {
        	const operateur = document.getElementById('operateur').value.trim();
        	if (operateur.toLowerCase() === 'gabou') {
            	document.body.classList.add('gabou-mode');
        	} else {
            	document.body.classList.remove('gabou-mode');
        	}
    	}

    	function autoSave() {
        	const data = getCurrentData();
        	localStorage.setItem('rapportBouchonnageData', JSON.stringify(data));
        	checkGabouMode();
    	}

    	function getCurrentData() {
        	const rows = [];
        	document.querySelectorAll('#tableau tbody tr').forEach(row => {
            	const inputs = row.querySelectorAll('input');
            	const selects = row.querySelectorAll('select');
            	rows.push({
                	distance: inputs[0].value,
                	typeService: selects[0].value,
                	adresse: inputs[1].value,
                	position: selects[1].value,
                	bouchon: selects[2].value,
                	estimation: selects[3].value,
                	percage: selects[4].value,
                	commentaires: inputs[2].value,
                	className: row.className
            	});
        	});

        	return {
            	projet: document.getElementById('projet').value,
            	date: document.getElementById('date').value,
            	ville: document.getElementById('ville').value,
            	rue: document.getElementById('rue').value,
            	puitsDebut: document.getElementById('puitsDebut').value,
            	puitsFin: document.getElementById('puitsFin').value,
            	operateur: document.getElementById('operateur').value,
            	longueurCamera: document.getElementById('longueurCamera').value,
            	longueurRoulette: document.getElementById('longueurRoulette').value,
            	diametre: diametreChoisi,
            	notes: document.getElementById('notes').value,
            	rows: rows,
            	lang: isFrench ? 'fr' : 'en'
        	};
    	}

    	function loadFromData(data) {
        	document.getElementById('projet').value = data.projet || '';
        	document.getElementById('date').value = data.date || '';
        	document.getElementById('ville').value = data.ville || '';
        	document.getElementById('rue').value = data.rue || '';
        	document.getElementById('puitsDebut').value = data.puitsDebut || '';
        	document.getElementById('puitsFin').value = data.puitsFin || '';
        	document.getElementById('operateur').value = data.operateur || '';
        	document.getElementById('longueurCamera').value = data.longueurCamera || '';
        	document.getElementById('longueurRoulette').value = data.longueurRoulette || '';
        	document.getElementById('notes').value = data.notes || '';

        	diametreChoisi = data.diametre || '';
        	if (diametreChoisi && diametreChoisi !== 'autre') {
            	document.querySelectorAll('.diametre-btn').forEach(btn => btn.classList.remove('active'));
            	const btn = Array.from(document.querySelectorAll('.diametre-btn')).find(b => b.textContent === diametreChoisi);
            	if (btn) btn.classList.add('active');
            	document.getElementById('diametreDisplay').textContent = (isFrench ? 'Diam√®tre : ' : 'Diameter: ') + diametreChoisi;
        	}

        	const tbody = document.querySelector('#tableau tbody');
        	tbody.innerHTML = '';
        	(data.rows || []).forEach(rowData => {
            	ajouterLigne();
            	const row = tbody.lastElementChild;
            	const inputs = row.querySelectorAll('input');
            	const selects = row.querySelectorAll('select');
            	inputs[0].value = rowData.distance || '';
            	selects[0].value = rowData.typeService || '';
            	inputs[1].value = rowData.adresse || '';
            	selects[1].value = rowData.position || '';
            	selects[2].value = rowData.bouchon || '';
            	selects[3].value = rowData.estimation || '';
            	selects[4].value = rowData.percage || '';
            	inputs[2].value = rowData.commentaires || '';
            	row.className = rowData.className || '';

            	appliquerTraitementSpecial(selects[0]);
        	});

        	if (tbody.children.length === 0) ajouterLigne();

        	checkGabouMode();
    	}

    	function loadData() {
        	const saved = localStorage.getItem('rapportBouchonnageData');
        	if (saved) {
            	loadFromData(JSON.parse(saved));
        	} else {
            	ajouterLigne();
            	checkGabouMode();
        	}
    	}

    	document.getElementById('operateur').addEventListener('input', checkGabouMode);
    	document.getElementById('operateur').addEventListener('change', checkGabouMode);

    	document.getElementById('saveBtn').onclick = () => {
        	const defaultName = (document.getElementById('projet').value || 'rapport_bouchonnage').replace(/[^a-zA-Z0-9_-]/g, '_');
        	const filename = prompt(isFrench ? "Nom du fichier (sans extension) :" : "File name (without extension):", defaultName);
        	if (!filename) return;

        	const data = getCurrentData();
        	const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        	const url = URL.createObjectURL(blob);
        	const a = document.createElement('a');
        	a.href = url;
        	a.download = filename.trim() + '.json';
        	a.click();
        	URL.revokeObjectURL(url);
        	alert(isFrench ? "Projet sauvegard√© !" : "Project saved!");
    	};

    	document.getElementById('driveBtn').onclick = () => {
        	const defaultName = (document.getElementById('projet').value || 'rapport_bouchonnage').replace(/[^a-zA-Z0-9_-]/g, '_');

        	const data = getCurrentData();
        	const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        	const url = URL.createObjectURL(blob);
        	const a = document.createElement('a');
        	a.href = url;
        	a.download = defaultName + '.json';
        	a.click();

        	setTimeout(() => {
            	window.open('https://drive.google.com/drive/my-drive', '_blank');
        	}, 500);

        	alert(isFrench ? "Fichier sauvegard√© localement. Ouvre Drive pour l'uploader." : "File saved locally. Open Drive to upload it.");
    	};

    	document.getElementById('loadBtn').onclick = () => document.getElementById('fileInput').click();

    	document.getElementById('fileInput').onchange = (e) => {
        	const file = e.target.files[0];
        	if (!file) return;
        	const reader = new FileReader();
        	reader.onload = (ev) => {
            	try {
                	const data = JSON.parse(ev.target.result);
                	loadFromData(data);
                	alert(isFrench ? 'Projet charg√© !' : 'Project loaded!');
            	} catch (err) {
                	alert(isFrench ? 'Fichier invalide.' : 'Invalid file.');
            	}
        	};
        	reader.readAsText(file);
        	document.getElementById('fileInput').value = '';
    	};

    	document.querySelectorAll('input, select, textarea').forEach(el => {
        	el.addEventListener('input', autoSave);
        	el.addEventListener('change', autoSave);
    	});

    	function toggleLang() {
        	isFrench = !isFrench;
        	const btn = document.getElementById('langBtn');
        	btn.textContent = isFrench ? 'FR' : 'EN';

        	if (isFrench) {
            	document.getElementById('title').textContent = 'Bouchonnage et Rapport de Per√ßage';
            	document.getElementById('labelProjet').textContent = 'Projet :';
            	document.getElementById('labelDate').textContent = 'Date :';
            	document.getElementById('labelVille').textContent = 'Ville :';
            	document.getElementById('labelRue').textContent = 'Rue :';
            	document.getElementById('labelPuits').textContent = 'Num√©ro de puits :';
            	document.getElementById('toText').textContent = '√†';
            	document.getElementById('labelDiametre').textContent = 'Diam√®tre :';
            	document.getElementById('labelOperateur').textContent = 'Op√©rateur :';
            	document.getElementById('labelLongueur').textContent = 'Longueur (m.) :';
            	document.getElementById('labelCamera').textContent = 'Cam√©ra';
            	document.getElementById('labelRoulette').textContent = 'Roulette';
            	document.getElementById('thDistance').textContent = 'Distance';
            	document.getElementById('thType').textContent = 'Type de service';
            	document.getElementById('thAdresse').textContent = 'Adresse';
            	document.getElementById('thPosition').textContent = 'Position';
            	document.getElementById('thBouchon').textContent = 'Bouchon';
            	document.getElementById('thEstimation').textContent = 'Estimation';
            	document.getElementById('thPercage').textContent = 'Per√ßage';
            	document.getElementById('thCommentaires').textContent = 'Commentaires';
            	document.getElementById('btnAddLine').textContent = 'Ajouter une ligne';
            	document.getElementById('deleteBtn').textContent = 'Effacer la derni√®re ligne';
            	document.getElementById('resetBtn').textContent = 'R√©initialiser tout';
            	document.getElementById('highlightText').textContent = 'Surligner la ligne :';
            	document.getElementById('labelNotes').textContent = 'Notes :';
        	} else {
            	document.getElementById('title').textContent = 'Plugging and Drilling Report';
            	document.getElementById('labelProjet').textContent = 'Project:';
            	document.getElementById('labelDate').textContent = 'Date:';
            	document.getElementById('labelVille').textContent = 'City:';
            	document.getElementById('labelRue').textContent = 'Street:';
            	document.getElementById('labelPuits').textContent = 'Pit :';
            	document.getElementById('toText').textContent = 'to';
            	document.getElementById('labelDiametre').textContent = 'Diameter:';
            	document.getElementById('labelOperateur').textContent = 'Operator:';
            	document.getElementById('labelLongueur').textContent = 'Length (m.):';
            	document.getElementById('labelCamera').textContent = 'Camera';
            	document.getElementById('labelRoulette').textContent = 'Wheel';
            	document.getElementById('thDistance').textContent = 'Distance';
            	document.getElementById('thType').textContent = 'Service Type';
            	document.getElementById('thAdresse').textContent = 'Address';
            	document.getElementById('thPosition').textContent = 'Position';
            	document.getElementById('thBouchon').textContent = 'Plug';
            	document.getElementById('thEstimation').textContent = 'Estimation';
            	document.getElementById('thPercage').textContent = 'Drilling';
            	document.getElementById('thCommentaires').textContent = 'Comments';
            	document.getElementById('btnAddLine').textContent = 'Add a line';
            	document.getElementById('deleteBtn').textContent = 'Delete last line';
            	document.getElementById('resetBtn').textContent = 'Reset all';
            	document.getElementById('highlightText').textContent = 'Highlight row:';
            	document.getElementById('labelNotes').textContent = 'Notes:';
        	}
        	autoSave();
    	}

    	function toggleTheme() {
        	document.body.classList.toggle('dark-mode');
        	const btn = document.getElementById('themeBtn');
        	btn.textContent = document.body.classList.contains('dark-mode') ? 'üåô' : '‚òÄÔ∏è';
        	autoSave();
    	}

    	function setDiametre(val) {
        	diametreChoisi = val;

        	document.querySelectorAll('.diametre-btn').forEach(btn => btn.classList.remove('active'));
        	event.target.classList.add('active');

        	const autreInput = document.getElementById('autreInput');
        	const display = document.getElementById('diametreDisplay');
        	const prefix = isFrench ? 'Diam√®tre : ' : 'Diameter: ';

        	if (val === 'autre') {
            	autreInput.style.display = 'inline-block';
            	autreInput.focus();
            	autreInput.value = '';
            	display.textContent = prefix + '(en cours...)';
        	} else {
            	autreInput.style.display = 'none';
            	display.textContent = prefix + val;
        	}
        	autoSave();
    	}

    	document.getElementById('autreInput').addEventListener('input', () => {
        	const autreInput = document.getElementById('autreInput');
        	const display = document.getElementById('diametreDisplay');
        	const prefix = isFrench ? 'Diam√®tre : ' : 'Diameter: ';
        	if (autreInput.value.trim() !== '') {
            	display.textContent = prefix + autreInput.value.trim();
            	diametreChoisi = autreInput.value.trim();
        	} else {
            	display.textContent = prefix + '(en cours...)';
        	}
        	autoSave();
    	});

    	function setHighlightColor(color) {
        	currentHighlight = color === 'none' ? '' : color;
        	document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
        	if (color !== 'none') {
            	event.target.classList.add('active');
        	}
        	autoSave();
    	}

    	function highlightRow(row) {
        	if (!currentHighlight) {
            	row.className = '';
            	return;
        	}
        	row.className = 'highlight-' + currentHighlight;
        	autoSave();
    	}

    	function trierTableau() {
        	const tbody = document.querySelector('#tableau tbody');
        	const rows = Array.from(tbody.rows);

        	rows.sort((a, b) => {
            	const valA = a.cells[0].querySelector('input').value.trim();
            	const valB = b.cells[0].querySelector('input').value.trim();

            	const numA = parseFloat(valA);
            	const numB = parseFloat(valB);

            	if (!isNaN(numA) && !isNaN(numB)) {
                	return numA - numB;
            	}
            	return valA.localeCompare(valB);
        	});

        	rows.forEach(row => tbody.appendChild(row));
        	autoSave();
    	}

    	function effacerDerniereLigne() {
        	const tbody = document.querySelector('#tableau tbody');
        	if (tbody.rows.length === 0) return;

        	const lastRow = tbody.lastElementChild;
        	const inputs = lastRow.querySelectorAll('input, select');
        	let hasContent = false;

        	inputs.forEach(el => {
            	if (el.value !== '' && el.value !== 'Choisir...') {
                	hasContent = true;
            	}
        	});

        	const confirmMsg = isFrench ? '√ätes-vous s√ªr de vouloir effacer la derni√®re ligne ?' : 'Are you sure you want to delete the last line?';

        	if (hasContent && !confirm(confirmMsg)) {
            	return;
        	}

        	tbody.removeChild(lastRow);
        	autoSave();
    	}

    	function reinitialiserTout() {
        	const confirmMsg = isFrench ? '√ätes-vous s√ªr de vouloir tout r√©initialiser ?' : 'Are you sure you want to reset everything?';

        	if (!confirm(confirmMsg)) {
            	return;
        	}

        	document.getElementById('projet').value = '';
        	document.getElementById('date').value = '';
        	document.getElementById('ville').value = '';
        	document.getElementById('rue').value = '';
        	document.getElementById('puitsDebut').value = '';
        	document.getElementById('puitsFin').value = '';
        	document.getElementById('operateur').value = '';
        	document.getElementById('longueurCamera').value = '';
        	document.getElementById('longueurRoulette').value = '';
        	document.getElementById('notes').value = '';

        	document.querySelectorAll('.diametre-btn').forEach(btn => btn.classList.remove('active'));
        	document.getElementById('autreInput').style.display = 'none';
        	document.getElementById('diametreDisplay').textContent = '';

        	document.querySelector('#tableau tbody').innerHTML = '';
        	ajouterLigne();

        	currentHighlight = '';
        	document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));

        	localStorage.removeItem('rapportBouchonnageData');
        	checkGabouMode();
    	}

    	function appliquerTraitementSpecial(select) {
        	const row = select.parentElement.parentElement;
        	const value = select.value;

        	const isClosed = value === 'fermer' || value === 'abandoner';
        	const isSpecial = ['T', 'bosse', '22¬∞', '45¬∞', '90¬∞', 'joint de plomb', 'autre'].includes(value);

        	[row.cells[2], row.cells[4], row.cells[5], row.cells[6]].forEach(cell => {
            	if (isClosed || isSpecial) {
                	cell.classList.add('blocked-cell');
            	} else {
                	cell.classList.remove('blocked-cell');
            	}
        	});

        	if (isSpecial) {
            	row.className = 'highlight-red';
        	}
        	autoSave();
    	}

    	function ajouterLigne() {
        	const tbody = document.querySelector('#tableau tbody');
        	const ligne = document.createElement('tr');

        	ligne.innerHTML += '<td><input type="text" onblur="trierTableau()"></td>';

        	ligne.innerHTML += `
            	<td>
                	<select onchange="appliquerTraitementSpecial(this)">
                    	<option value="">Choisir...</option>
                    	<option>service</option>
                    	<option>service np</option>
                    	<option>service penetran</option>
                    	<option>sellette</option>
                    	<option>fermer</option>
                    	<option>abandoner</option>
                    	<option>T</option>
                    	<option>bosse</option>
                    	<option>22¬∞</option>
                    	<option>45¬∞</option>
                    	<option>90¬∞</option>
                    	<option>joint de plomb</option>
                    	<option>autre</option>
                	</select>
            	</td>`;

        	ligne.innerHTML += '<td><input type="text"></td>';

        	let optionsPos = '<option value="">Choisir...</option>';
        	for (let i = 1; i <= 12; i++) {
            	optionsPos += `<option>${i}</option>`;
        	}
        	optionsPos += '<option>droite</option><option>gauche</option>';
        	ligne.innerHTML += `<td><select>${optionsPos}</select></td>`;

        	const fractions = ['1/2', '5/8', '3/4', '7/8', '1', '1 1/4', '1 1/2', '1 5/8', '1 3/4', '1 7/8', '2'];
        	let optionsFrac = '<option value="">Choisir...</option>';
        	fractions.forEach(f => optionsFrac += `<option>${f}</option>`);

        	ligne.innerHTML += `<td><select>${optionsFrac}</select></td>`;
        	ligne.innerHTML += `<td><select>${optionsFrac}</select></td>`;

        	ligne.innerHTML += `
            	<td>
                	<select>
                    	<option value="">Choisir...</option>
                    	<option>percer</option>
                    	<option>boucher</option>
                    	<option>partiellement boucher</option>
                    	<option>defaut percement</option>
                    	<option>hors cible</option>
                	</select>
            	</td>`;

        	ligne.innerHTML += '<td><input type="text"></td>';

        	ligne.addEventListener('click', () => highlightRow(ligne));

        	tbody.appendChild(ligne);
        	autoSave();
    	}

    	loadData();
	</script>
	
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/pwabuilder-sw.js');  // ou le nom exact du fichier que tu as upload√©
    });
  }
</script>

</body>
</html>
